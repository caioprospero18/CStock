<div class="entry-container">
  <div class="entry-header">
    <h2>Gráficos de Entrada
      <span class="entry-loading-badge" *ngIf="loading">CARREGANDO...</span>
    </h2>

    <div class="entry-controls">
      <div class="entry-period-selector">
        <label for="periodSelect">Período:</label>
        <p-dropdown
          [options]="periodOptions"
          [(ngModel)]="selectedPeriod"
          (onChange)="onPeriodChange()"
          placeholder="Selecione o período"
          [style]="{'width': '200px'}">
        </p-dropdown>
      </div>

      <div class="entry-refresh-controls">
        <button pButton
                class="entry-custom-refresh-btn"
                (click)="forceRefresh()"
                [disabled]="loading">
          Atualizar Agora
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="entry-loading">
    <p-progressSpinner></p-progressSpinner>
    <span>Carregando dados de entrada...</span>
  </div>

  <div *ngIf="!loading && !hasData()" class="entry-no-data">
    <p>Nenhuma entrada registrada para o período selecionado.</p>
    <button pButton
            icon="pi pi-refresh"
            class="p-button-outlined"
            (click)="forceRefresh()">
      Tentar Novamente
    </button>
  </div>

  <div *ngIf="!loading && hasData()" class="entry-charts-container">
    <div class="entry-chart-card">
      <div class="entry-chart-header">
        <h3>Top 5 Entradas - {{ getPeriodLabel() }}</h3>
        <span class="entry-chart-update-info" *ngIf="topEntries.length > 0">
          Atualizado às {{ getCurrentTime() }}
        </span>
      </div>

      <div *ngIf="topEntries.length > 0" class="entry-chart-wrapper">
        <canvas #entryChart width="400" height="300"></canvas>
      </div>

      <div class="entry-data-table" *ngIf="topEntries.length > 0">
        <p-table [value]="topEntries" [paginator]="false" [rows]="10">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Quantidade Total</th>
              <th>Última Atualização</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.productName }}</td>
              <td class="entry-quantity">{{ item.totalQuantity }}</td>
              <td class="entry-update-time">{{ getCurrentTime() }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
    <div class="entry-chart-card">
      <div class="entry-chart-header">
        <h3>Top 5 Gastos - {{ getPeriodLabel() }}</h3>
        <span class="entry-chart-update-info" *ngIf="topExpenses.length > 0">
          Atualizado às {{ getCurrentTime() }}
        </span>
      </div>

      <div *ngIf="topExpenses.length > 0" class="entry-chart-wrapper">
        <canvas #expenseChart width="400" height="300"></canvas>
      </div>

      <div class="entry-data-table" *ngIf="topExpenses.length > 0">
        <p-table [value]="topExpenses" [paginator]="false" [rows]="10">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Valor Total</th>
              <th>Última Atualização</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.productName }}</td>
              <td class="entry-value">R$ {{ item.totalValue | number:'1.2-2' }}</td>
              <td class="entry-update-time">{{ getCurrentTime() }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>

  <div class="entry-footer-info" *ngIf="!loading">
    <p>
      <i class="pi pi-info-circle"></i>
      Os gráficos são atualizados automaticamente a cada 30 segundos.
      <span *ngIf="hasData()">Última verificação: {{ getCurrentTime() }}</span>
    </p>
  </div>
</div>
