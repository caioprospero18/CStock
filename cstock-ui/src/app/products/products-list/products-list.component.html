<div class="list">
  <div class="products-container">
    <div class="search-bar">

      <div class="search-grid">
        <div class="search-field">
          <label for="productName"><strong>Nome do Produto</strong></label>
          <div class="input-with-icon">
            <i class="fas fa-box"></i>
            <input
              id="productName"
              type="text"
              class="search-input"
              placeholder="Digite o nome do produto"
              [(ngModel)]="productName"
              (keyup.enter)="search()"
              [disabled]="loading">
          </div>
        </div>

        <div class="search-field">
          <label for="brand"><strong>Marca</strong></label>
          <div class="input-with-icon">
            <i class="fas fa-tag"></i>
            <input
              id="brand"
              type="text"
              class="search-input"
              placeholder="Digite a marca"
              [(ngModel)]="brand"
              (keyup.enter)="search()"
              [disabled]="loading">
          </div>
        </div>

        <div class="search-buttons">
          <button
            class="btn btn-primary"
            (click)="search()"
            [disabled]="loading">
            <i class="fas fa-search"></i>
            Pesquisar
          </button>
          <button
            class="btn btn-secondary"
            (click)="clearFilters()"
            [disabled]="loading">
            <i class="fas fa-eraser"></i>
            Limpar
          </button>
        </div>
      </div>
    </div>

    <p-table [value]="products" responsiveLayout="stack" [breakpoint]="'768px'">
      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Marca</th>
          <th>Quantidade</th>
          <th>Valor unitário</th>
          <th>Valor total</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-product>
        <tr>
          <td>{{ product.id }}</td>
          <td>{{ product.productName }}</td>
          <td>{{ product.brand }}</td>
          <td>{{ product.quantity }}</td>
          <td>R$ {{ product.unitValue }}</td>
          <td>R$ {{ product.totalValue }}</td>
          <td>
            <a href="javascript:void(0)" (click)="showProductUpdateForm(product)">Alterar</a>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="custom-table-empty">
            <p>Nenhum produto cadastrado.</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <div class="fixed-footer-buttons">
    <button *ngIf="'ROLE_REGISTER_PRODUCT' | hasRole" pButton label="Registrar produto" (click)="showRegisterForm()"></button>
    <button *ngIf="'ROLE_REGISTER_STOCK_MOVEMENT' | hasRole" pButton label="Registrar saída" (click)="showStockExitForm()"></button>
    <button *ngIf="'ROLE_REGISTER_STOCK_MOVEMENT' | hasRole" pButton label="Registrar entrada" (click)="showStockEntryForm()"></button>
    <button *ngIf="'ROLE_REGISTER_STOCK_MOVEMENT' | hasRole" pButton label="Registrar pedido" (click)="showOrderRequestForm()"></button>
    <button *ngIf="'ROLE_REGISTER_USER' | hasRole" pButton label="Registrar/Alterar usuário" (click)="showRegisterUserForm()"></button>
    <button *ngIf="'ROLE_REGISTER_ENTERPRISE' | hasRole" pButton label="Registrar/Alterar empresa" (click)="showRegisterEnterpriseForm()"></button>
  </div>
</div>

<div class="form-product-register">
  <p-confirmDialog
    [style]="{width: '600px'}"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showProductForm">
    <div class="form-container">
      <app-product-register
        (onSave)="onProductSaved($event)"
        (onCancel)="showProductForm = false">
      </app-product-register>
    </div>
  </div>
</div>

<div class="form-stock-entry">
  <p-confirmDialog
    [style]="{width: '600px'}"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showEntryForm">
    <div class="form-container">
      <app-stock-entry
        (onSave)="onEntrySaved($event)"
        (onCancel)="showEntryForm = false">
      </app-stock-entry>
    </div>
  </div>
</div>

<div class="form-stock-exit">
  <p-confirmDialog
    [style]="{width: '600px'}"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showExitForm">
    <div class="form-container">
      <app-stock-exit
        (onSave)="onExitSaved($event)"
        (onCancel)="showExitForm = false">
      </app-stock-exit>
    </div>
  </div>
</div>

<div class="form-order-request">
  <p-confirmDialog
    [style]="{width: '600px'}"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showOrderForm">
    <div class="form-container">
      <app-order-request
        (onSave)="onOrderRequestSaved($event)"
        (onCancel)="showOrderForm = false">
      </app-order-request>
    </div>
  </div>
</div>

<div class="form-register-user">
  <p-confirmDialog
    styleClass="custom-confirm-dialog"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showUserForm">
    <div class="form-container">
      <app-user-register
        [userInput]="selectedUserForUpdate"
        (onSave)="onRegisterUserSaved($event)"
        (onUpdateRequest)="showUpdateUserForm()"
        (onDelete)="onUserDeleted($event)"
        (onCancel)="onUserFormCancel()">
      </app-user-register>
    </div>
  </div>
</div>

<div class="form-user-update">
  <p-confirmDialog
    styleClass="custom-confirm-dialog"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showUpdateForm">
    <div class="form-container">
      <app-user-update
        [isOpen]="showUpdateForm"
        (onUpdate)="onUserSelectedForUpdate($event)"
        (onCancel)="onUpdateUserCancel()">
    </app-user-update>
    </div>
  </div>
</div>

<div class="form-product-update">
  <p-confirmDialog
    [style]="{width: '600px'}"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showProductUForm">
    <div class="form-container">
      <app-product-update
        [productInput]="selectedProduct"
        (onSave)="onProductUpdateSaved($event)"
        (onDelete)="onProductDeleted($event)"
        (onCancel)="showProductUForm = false">
      </app-product-update>
    </div>
  </div>
</div>

<div class="form-register-enterprise">
  <p-confirmDialog
    styleClass="custom-confirm-dialog"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showEnterpriseForm">
    <div class="form-container">
      <app-enterprise-register
        [enterpriseInput]="selectedEnterpriseForUpdate"
        (onSave)="onRegisterEnterpriseSaved($event)"
        (onUpdateRequest)="showUpdateEnterpriseForm()"
        (onDelete)="onEnterpriseDeleted($event)"
        (onCancel)="onEnterpriseFormCancel()">
      </app-enterprise-register>
    </div>
  </div>
</div>

<div class="form-enterprise-update">
  <p-confirmDialog
    styleClass="custom-confirm-dialog"
    [baseZIndex]="10000">
  </p-confirmDialog>

  <div class="form-overlay" [class.visible]="showUpdateEForm">
    <div class="form-container">
      <app-enterprise-update
        [isOpen]="showUpdateEForm"
        (onUpdate)="onEnterpriseSelectedForUpdate($event)"
        (onCancel)="onUpdateEnterpriseCancel()">
    </app-enterprise-update>
    </div>
  </div>
</div>


